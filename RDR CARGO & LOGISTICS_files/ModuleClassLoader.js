define("ModuleClassLoader",["jquery","moduleVersions","log","spine","webs.modules"],function(a,b,c){var d=3e4,e=a.Deferred().resolve().promise(),f=Spine.Class.create({init:function(a){this.MODULES_URL=a.MODULES_URL,this.MODULES_VERSION=a.MODULES_VERSION,this.classes={},this.modulePromises={}},getClass:function(a){return this.classes[a]},register:function(a,b,c){var d;c.slug=a,c.iframe?d=webs.modules.IframeModule:c.isWidget?d=webs.modules.WidgetModule:c.submodules?d=webs.modules.CompositeModule:d=webs.modules.CustomModule,this.classes[a]=d.create(b,c)},create:function(b,d){var e=this,f=this.getClass(b),g=a.Deferred();if(!f){if(b.indexOf("app-sidebar-")!=0)return e.load(b).done(function(){e.create(b,d).done(g.resolve).fail(g.reject)}).fail(g.reject),g.promise();f=this.classes[b]=webs.modules.AppModule.create({id:b.substring(12)}),c.error("Unable to load appmodule",b)}var h=a.extend({},f),i=a.extend(!0,{},f.defaultData,d.data),j=f.styles[i._style]||f.defaultStyle;if(i.bucketContents&&d.data&&d.data.bucketContents){i.bucketContents=d.data.bucketContents;for(var k=0,l=i.cols.length;k<l;k++)i.cols[k].image||(c.error("An image within buckets was null"),i.cols[k].image=f.defaultData.cols[0].image)}b=="contact_form"&&d.data&&d.data.fields&&(i.fields=d.data.fields);var m=this.getClassForStyle(f,j).init({el:d.container||d.el,data:i});return g.resolve(m),this.trigger("created",m),g.promise()},getClassForStyle:function(a,b){if(b){var d=[];do d.push(b);while(b=a.styles[b.inherit]);var e=a,f,g;for(var h=d.length-1;h>=0;h--){g=d[h],f=g.klass;if(!f){delete g.defaultStyle;if(g.global.js){var i={},j={};g.global.js(i,j),g.klass=f=e.create(i,j)}else g.klass=f=e}e=f}return e}return c&&c.trigger("Modules","info","No style found for "+a.slug+" module!",a),a},getModuleVersion:function(a){var d;return b&&a in b?d="v"+b[a]:(c.warn("WARNING: Retrieving unversioned asset for module "+a),d=this.MODULES_VERSION),d},getModuleAssetURL:function(a,b){return this.MODULES_URL+a+"/"+this.getModuleVersion(a)+"/"+b},cssPath:function(a){return this.getModuleAssetURL(a,"view.packaged.less")},load:function(b){if(this.modulePromises[b])return this.modulePromises[b];var c=this,e=a.Deferred(),f=this.loadCss(this.cssPath(b)),g=a.Deferred();return this.loadJs(b).done(function(){c.loadModuleDependencies(b).done(g.resolve).fail(g.reject)}).fail(g.reject),a.when(f,g).done(e.resolve).fail(e.reject),setTimeout(e.reject,d),this.modulePromises[b]=e.promise()},loadAll:function(b){var c=a.Deferred(),d=[];for(var e=0,f=b.length;e<f;e++)d.push(this.load(b[e]));return a.when.apply(a,d).done(c.resolve).fail(c.reject),c.promise()},loadCss:function(a){return e},loadJs:function(b){var c=a.Deferred();return require([this.getModuleAssetURL(b,b+"_view.js")],c.resolve),c.promise()},themeStyleFileList:function(b){var d=this,e=this.getClass(b),f=webs.theme,g=[],h=[];return f.moduleStyles&&f.moduleStyles[b]&&a.each(f.moduleStyles[b],function(a,i){c&&c.trigger("Modules","debug","Loading theme style "+a+" for "+b),e.styles[a]=i,i.slug=a,i.global.js&&g.push(f.url+"/"+i.global.js),i.global.css&&h.push(d.loadCss(f.url+"/"+i.global.css)),i["default"]&&(e.defaultStyle=i)}),[g,a.when.apply(a,h)]},moduleDependencyList:function(b){var c=[],d=this.getClass(b);return d.submodules&&a.each(d.submodules,function(a,b){c.push(a)}),c},loadModuleDependencies:function(b){var c=this,d=this.themeStyleFileList(b),e=d[0],f=d[1],g=this.moduleDependencyList(b),h=e.length+g.length,i=0;if(h==0)return f;var j=a.Deferred(),k=[f];return a.each(g,function(a,b){k.push(c.load(b))}),a.each(e,function(b,c){var d=a.Deferred();k.push(d),require([script(c)],d.resolve)}),a.when.apply(a,k).done(j.resolve).fail(j.reject),j.promise()}});f.include(Spine.Events);var g=f.init({MODULES_URL:webs.props.membersServer+"/s/modules/",MODULES_VERSION:webs.props.modulesVersion}),h=a.Deferred();return g.renderedModulesPromise=h.promise(),a(function(){a.when.apply(a,webs.renderedModulesPromises||[]).done(h.resolve).fail(h.reject)}),webs.modules.ModuleClassLoader=g,g})